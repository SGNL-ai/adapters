---
version: 2
interactions:
  # First page - initial request with low limit to test pagination
  - id: 0
    request:
      proto: HTTP/1.1
      proto_major: 1
      proto_minor: 1
      content_length: 14
      transfer_encoding: []
      trailer: {}
      host: api.us-2.crowdstrike.com
      remote_addr: ""
      request_uri: ""
      body: '{"limit":2}'
      form: {}
      headers:
        Authorization:
          - Bearer {{OMITTED}}
        Content-Type:
          - application/json
      url: https://api.us-2.crowdstrike.com/alerts/combined/alerts/v1?limit=2
      method: POST
    response:
      proto: HTTP/1.1
      proto_major: 1
      proto_minor: 1
      transfer_encoding:
        - chunked
      trailer: {}
      content_length: -1
      uncompressed: true
      body: |-
        {
          "meta": {
            "query_time": 0.043633983,
            "pagination": {
              "total": 23,
              "limit": 2,
              "after": "eyJ2ZXJzaW9uIjoidjEiLCJ0b3RhbF9oaXRzIjoyMywidG90YWxfcmVsYXRpb24iOiJlcSIsImNsdXN0ZXJfaWQiOiJ0ZXN0IiwiYWZ0ZXIiOlsxNzQ5NjExMTU3MjIxLCJ0ZXN0aWQ6aW5kOjUzODhjNTkyMTg5NDQ0YWQ5ZTg0ZGYwNzFjOGYzOTU0Ojk3ODI3ODI2MTQtMTAzMDMtMzE4MzE1NjgiXSwidG90YWxfZmV0Y2hlZCI6Mn0="
            },
            "powered_by": "detectsapi",
            "trace_id": "00774ad1-9fbf-43c2-9d9e-d90ea9216ba0"
          },
          "errors": [],
          "resources": [
            {
              "agent_id": "test1234567890123456789012345678",
              "aggregate_id": "aggind:test1234567890123456789012345678:625985642613668398",
              "cid": "testcid1234567890123456789012345",
              "cloud_indicator": "false",
              "cmdline": "cat",
              "composite_id": "testcid1234567890123456789012345:ind:test1234567890123456789012345678:625985642593750673-20151-7049",
              "confidence": 80,
              "context_timestamp": "2025-06-16T18:46:54.925Z",
              "control_graph_id": "ctg:test1234567890123456789012345678:625985642613668398",
              "crawled_timestamp": "2025-06-16T19:46:56.218776698Z",
              "created_timestamp": "2025-06-16T18:47:56.231503572Z",
              "data_domains": ["Endpoint"],
              "description": "A process has written a known EICAR test file. Review the files written by the triggered process.",
              "device": {
                "agent_load_flags": "0",
                "agent_local_time": "2025-01-05T13:11:22.705Z",
                "agent_version": "7.24.19504.0",
                "cid": "testcid1234567890123456789012345",
                "config_id_base": "65994763",
                "config_id_build": "19504",
                "config_id_platform": "4",
                "device_id": "test1234567890123456789012345678",
                "external_ip": "192.168.1.100",
                "first_seen": "2025-06-16T17:30:34Z",
                "hostinfo": {"domain": ""},
                "hostname": "TEST-HOST.localdomain",
                "last_seen": "2025-06-16T19:36:52Z",
                "local_ip": "192.168.1.15",
                "mac_address": "00-11-22-33-44-55",
                "machine_domain": "",
                "major_version": "24",
                "minor_version": "5",
                "modified_timestamp": "2025-06-16T19:44:11Z",
                "os_version": "Sequoia (15)",
                "ou": null,
                "platform_id": "1",
                "platform_name": "Mac",
                "product_type_desc": "Workstation",
                "status": "normal",
                "system_manufacturer": "Apple Inc.",
                "system_product_name": "MacBookPro18,1"
              },
              "display_name": "EICARTestFileWrittenMac",
              "email_sent": true,
              "falcon_host_link": "https://falcon.us-2.crowdstrike.com/activity-v2/detections/testcid1234567890123456789012345:ind:test1234567890123456789012345678:625985642593750673-20151-7049?_cid=testcid",
              "filename": "cat",
              "filepath": "/bin/cat",
              "global_prevalence": "common",
              "id": "ind:test1234567890123456789012345678:625985642593750673-20151-7049",
              "local_prevalence": "unique",
              "local_process_id": "4077",
              "md5": "27549b2faf16aed0ea0a74bd35c6694e",
              "name": "EICARTestFileWrittenMac",
              "objective": "Follow Through",
              "pattern_id": 20151,
              "platform": "Mac",
              "priority_value": 10,
              "process_id": "625985642593750673",
              "product": "epp",
              "severity": 10,
              "severity_name": "Informational",
              "sha1": "0000000000000000000000000000000000000000",
              "sha256": "9844bd3abe6c59d9cc1ddba3ba35aab555d5ec483db326c183af3c4a6caefbc1",
              "show_in_ui": true,
              "status": "new",
              "tactic": "Execution",
              "tactic_id": "TA0002",
              "technique": "User Execution",
              "technique_id": "T1204",
              "timestamp": "2025-06-16T18:46:54.988Z",
              "type": "ldt",
              "updated_timestamp": "2025-06-16T19:46:56.218762664Z",
              "user_id": "S-1-5-21-1234567890-1234567890-1234567890-2004",
              "user_name": "testuser",
              "user_principal": "testuser@TEST-HOST.localdomain"
            },
            {
              "agent_id": "test2345678901234567890123456789",
              "aggregate_id": "aggind:test2345678901234567890123456789:726196753724579846",
              "cid": "testcid1234567890123456789012345",
              "composite_id": "testcid1234567890123456789012345:ind:test2345678901234567890123456789:726196753704661621-20152-7050",
              "confidence": 75,
              "created_timestamp": "2025-06-17T14:32:18.445672891Z",
              "data_domains": ["Endpoint"],
              "description": "Suspicious network activity detected from unknown source.",
              "display_name": "SuspiciousNetworkActivity",
              "id": "ind:test2345678901234567890123456789:726196753704661621-20152-7050",
              "platform": "Windows",
              "severity": 50,
              "severity_name": "Medium",
              "status": "in_progress",
              "type": "ldt"
            }
          ]
        }
      headers:
        Connection:
          - keep-alive
        Content-Type:
          - application/json
        Date:
          - Sun, 18 Aug 2025 20:30:00 GMT
        Server:
          - nginx
        Strict-Transport-Security:
          - max-age=31536000; includeSubDomains
        X-Cs-Region:
          - us-2
        X-Cs-Traceid:
          - combined-alerts-smoke-001
        X-Ratelimit-Limit:
          - "6000"
        X-Ratelimit-Remaining:
          - "5999"
      status: 200 OK
      code: 200
      duration: 145.678901ms

  # Second page - test pagination with cursor token
  - id: 1
    request:
      proto: HTTP/1.1
      proto_major: 1
      proto_minor: 1
      content_length: 155
      transfer_encoding: []
      trailer: {}
      host: api.us-2.crowdstrike.com
      remote_addr: ""
      request_uri: ""
      body: '{"limit":2,"after":"eyJ2ZXJzaW9uIjoidjEiLCJ0b3RhbF9oaXRzIjoyMywidG90YWxfcmVsYXRpb24iOiJlcSIsImNsdXN0ZXJfaWQiOiJ0ZXN0IiwiYWZ0ZXIiOlsxNzQ5NjExMTU3MjIxLCJ0ZXN0aWQ6aW5kOjUzODhjNTkyMTg5NDQ0YWQ5ZTg0ZGYwNzFjOGYzOTU0Ojk3ODI3ODI2MTQtMTAzMDMtMzE4MzE1NjgiXSwidG90YWxfZmV0Y2hlZCI6Mn0="}'
      form: {}
      headers:
        Authorization:
          - Bearer {{OMITTED}}
        Content-Type:
          - application/json
      url: https://api.us-2.crowdstrike.com/alerts/combined/alerts/v1?limit=2
      method: POST
    response:
      proto: HTTP/1.1
      proto_major: 1
      proto_minor: 1
      transfer_encoding:
        - chunked
      trailer: {}
      content_length: -1
      uncompressed: true
      body: |-
        {
          "meta": {
            "query_time": 0.028765432,
            "pagination": {
              "total": 23,
              "limit": 2,
              "after": "eyJ2ZXJzaW9uIjoidjEiLCJ0b3RhbF9oaXRzIjoyMywidG90YWxfcmVsYXRpb24iOiJlcSIsImNsdXN0ZXJfaWQiOiJ0ZXN0IiwiYWZ0ZXIiOlsxNzQ5NTEyMzQ1Njc4LCJ0ZXN0aWQ6aW5kOmU0NTY3ODkwMTIzNDU2Nzg5MGNkZWYxMjM0NTY3ODkwLTIwMTUzLTcwNTEiXSwidG90YWxfZmV0Y2hlZCI6NH0="
            },
            "powered_by": "detectsapi",
            "trace_id": "11885be2-0gcd-54d3-ae0f-e91fb0327cb1"
          },
          "errors": [],
          "resources": [
            {
              "agent_id": "test3456789012345678901234567890",
              "aggregate_id": "aggind:test3456789012345678901234567890:827307864835690957",
              "cid": "testcid1234567890123456789012345",
              "composite_id": "testcid1234567890123456789012345:ind:test3456789012345678901234567890:827307864815772732-20153-7052",
              "confidence": 90,
              "created_timestamp": "2025-06-18T09:15:42.678912345Z",
              "data_domains": ["Endpoint"],
              "description": "Advanced persistent threat activity successfully mitigated.",
              "display_name": "APTActivity",
              "falcon_host_link": "https://falcon.us-2.crowdstrike.com/activity-v2/detections/testcid1234567890123456789012345:ind:test3456789012345678901234567890:827307864815772732-20153-7052?_cid=testcid",
              "id": "ind:test3456789012345678901234567890:827307864815772732-20153-7052",
              "platform": "Linux",
              "priority_value": 80,
              "severity": 80,
              "severity_name": "High",
              "show_in_ui": true,
              "status": "closed",
              "tactic": "Defense Evasion",
              "tactic_id": "TA0005",
              "technique": "Masquerading",
              "technique_id": "T1036",
              "timestamp": "2025-06-18T09:15:42.678Z",
              "type": "ldt",
              "updated_timestamp": "2025-06-18T09:45:12.123456789Z"
            }
          ]
        }
      headers:
        Connection:
          - keep-alive
        Content-Type:
          - application/json
        Date:
          - Sun, 18 Aug 2025 20:30:01 GMT
        Server:
          - nginx
        Strict-Transport-Security:
          - max-age=31536000; includeSubDomains
        X-Cs-Region:
          - us-2
        X-Cs-Traceid:
          - combined-alerts-smoke-002
        X-Ratelimit-Limit:
          - "6000"
        X-Ratelimit-Remaining:
          - "5998"
      status: 200 OK
      code: 200
      duration: 112.345678ms

  # Final page - test end of pagination (empty after token)
  - id: 2
    request:
      proto: HTTP/1.1
      proto_major: 1
      proto_minor: 1
      content_length: 155
      transfer_encoding: []
      trailer: {}
      host: api.us-2.crowdstrike.com
      remote_addr: ""
      request_uri: ""
      body: '{"limit":2,"after":"eyJ2ZXJzaW9uIjoidjEiLCJ0b3RhbF9oaXRzIjoyMywidG90YWxfcmVsYXRpb24iOiJlcSIsImNsdXN0ZXJfaWQiOiJ0ZXN0IiwiYWZ0ZXIiOlsxNzQ5NTEyMzQ1Njc4LCJ0ZXN0aWQ6aW5kOmU0NTY3ODkwMTIzNDU2Nzg5MGNkZWYxMjM0NTY3ODkwLTIwMTUzLTcwNTEiXSwidG90YWxfZmV0Y2hlZCI6NH0="}'
      form: {}
      headers:
        Authorization:
          - Bearer {{OMITTED}}
        Content-Type:
          - application/json
      url: https://api.us-2.crowdstrike.com/alerts/combined/alerts/v1?limit=2
      method: POST
    response:
      proto: HTTP/1.1
      proto_major: 1
      proto_minor: 1
      transfer_encoding:
        - chunked
      trailer: {}
      content_length: -1
      uncompressed: true
      body: |-
        {
          "meta": {
            "query_time": 0.015432109,
            "pagination": {
              "total": 23,
              "limit": 2,
              "after": ""
            },
            "powered_by": "detectsapi",
            "trace_id": "22996cf3-1hde-65e4-bf1g-f02gc1438dc2"
          },
          "errors": [],
          "resources": [
            {
              "agent_id": "test4567890123456789012345678901",
              "aggregate_id": "aggind:test4567890123456789012345678901:928418975946802068",
              "cid": "testcid1234567890123456789012345",
              "composite_id": "testcid1234567890123456789012345:ind:test4567890123456789012345678901:928418975926883843-20154-7053",
              "confidence": 95,
              "created_timestamp": "2025-06-19T16:42:18.789123456Z",
              "data_domains": ["Endpoint"],
              "description": "Ransomware indicators detected and quarantined successfully.",
              "display_name": "RansomwareDetection",
              "falcon_host_link": "https://falcon.us-2.crowdstrike.com/activity-v2/detections/testcid1234567890123456789012345:ind:test4567890123456789012345678901:928418975926883843-20154-7053?_cid=testcid",
              "id": "ind:test4567890123456789012345678901:928418975926883843-20154-7053",
              "platform": "Windows",
              "priority_value": 100,
              "severity": 100,
              "severity_name": "Critical",
              "show_in_ui": true,
              "status": "new",
              "tactic": "Impact",
              "tactic_id": "TA0040",
              "technique": "Data Encrypted for Impact",
              "technique_id": "T1486",
              "timestamp": "2025-06-19T16:42:18.789Z",
              "type": "ldt",
              "updated_timestamp": "2025-06-19T17:01:22.456789123Z"
            }
          ]
        }
      headers:
        Connection:
          - keep-alive
        Content-Type:
          - application/json
        Date:
          - Sun, 18 Aug 2025 20:30:02 GMT
        Server:
          - nginx
        Strict-Transport-Security:
          - max-age=31536000; includeSubDomains
        X-Cs-Region:
          - us-2
        X-Cs-Traceid:
          - combined-alerts-smoke-003
        X-Ratelimit-Limit:
          - "6000"
        X-Ratelimit-Remaining:
          - "5997"
      status: 200 OK
      code: 200
      duration: 89.123456ms